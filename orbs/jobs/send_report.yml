description: "Runs codacy-coverage-reporter on a tool"

executor: machine

parameters:
  tool_version:
    type: string
    default: latest
    description: "Specify Codacy's coverage reporter tool version"

steps:
  - attach_workspace:
      at: ~/workdir
  - restore_cache:
      key: codacy-coverage-reporter-cache-$CODACY_COVERAGE_REPORTER_VERSION-<< parameters.tool_version >>
  - run:
      command: |
        export CODACY_REPORTER_VERSION=<< parameters.tool_version >>
        bash <(curl -Ls https://coverage.codacy.com/get.sh)
  - save_cache:
      key: codacy-coverage-reporter-cache-$CODACY_COVERAGE_REPORTER_VERSION-<< parameters.tool_version >>
      paths:
        - .codacy-coverage
